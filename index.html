import React, { useEffect, useState } from 'react';
import './style.css';
import { fetchMarketData, fetchEvents, fetchScarcityMetrics } from './script';

export default function Home() {
  const [marketData, setMarketData] = useState(null);
  const [events, setEvents] = useState([]);
  const [scarcityMetrics, setScarcityMetrics] = useState(null);

  useEffect(() => {
    async function loadData() {
      const data = await fetchMarketData();
      setMarketData(data);

      const upcomingEvents = await fetchEvents();
      setEvents(upcomingEvents.slice(0, 4)); // pr√≥ximos 4 eventos

      const scarcity = await fetchScarcityMetrics();
      setScarcityMetrics(scarcity);
    }
    loadData();
  }, []);

  return (
    <div className="page-container">
      {/* Bloco inicial */}
      <header className="header-block">
        <h1>What Matters</h1>
        <p>Your guide to market insights and scarcity metrics</p>
      </header>

      {/* Market sentiment */}
      {marketData && (
        <section className="section-block">
          <h2>Market sentiment</h2>
          <div className="market-sentiment">
            <div>Fear & Greed Index: {marketData.fearGreedIndex} - {marketData.sentiment}</div>
            <div>Volatility (30d): {marketData.volatility30d}% - {marketData.volatilityStatus}</div>
            <div>BTC Dominance: {marketData.btcDominance}%</div>
            <div>Transaction Volume (24h): {marketData.transactionVolume}</div>
            <div>Total Market Cap: {marketData.totalMarketCap}</div>
            <div>Market Liquidity: {marketData.marketLiquidity}</div>
          </div>
        </section>
      )}

      {/* Upcoming events */}
      <section className="section-block">
        <h2>Upcoming events</h2>
        <div className="events-container">
          {events.map((event, idx) => (
            <div key={idx} className="event-card">
              <h3>{event.title}</h3>
              <p>{event.date}</p>
              <p>{event.description}</p>
            </div>
          ))}
        </div>
      </section>

      {/* Scarcity metrics */}
      {scarcityMetrics && (
        <section className="section-block scarcity-metrics">
          <h2>Scarcity metrics</h2>
          <div className="scarcity-container">
            <div className="scarcity-item gold">{scarcityMetrics.gold}</div>
            <div className="scarcity-item silver">{scarcityMetrics.silver}</div>
            <div className="scarcity-item bitcoin">{scarcityMetrics.bitcoin}</div>
          </div>
        </section>
      )}

      {/* Global market capitalization */}
      <section className="section-block">
        <h2>Global market capitalization</h2>
        <p>Total Capitalization: $690.7T</p>
        <p className="sources">
          Sources: Visual Capitalist, Bank for International Settlements (BIS), McKinsey Global Institute, World Gold Council, Jesse Myers (onceinaspecies.com)
        </p>
      </section>

      {/* Latest news */}
      <section className="section-block">
        <h2>Latest news</h2>
        <p>Loading news...</p>
      </section>

      {/* Word of Satoshi */}
      <section className="section-block">
        <h2>Word of Satoshi</h2>
        <blockquote>
          "The root problem with conventional currency is all the trust that's required to make it work. The central bank must be trusted not to debase the currency, but the history of fiat currencies is full of breaches of that trust."
        </blockquote>
      </section>
    </div>
  );
}
